# DEVELOPMENT

## Основные сущности
- **Комната** (`rooms`): уникальный номер комнаты, `telegram_chat_id` (опционально)
- **Письмо** (`letters`): привязка к комнате (`room_id`), статус, дата добавления, дата доставки, `sync_status`

## MVP-функционал
- Просмотр всех комнат и количества писем в каждой
- Просмотр и добавление писем для выбранной комнаты
- Нет поддержки штрих-кодов и PWA

## UI
- **Главная страница:** список комнат и количество писем
- **Страница комнаты:** список писем и форма добавления письма (только номер комнаты)

## База данных
- Нет поля `barcode_id`
- Нет поддержки PWA и офлайн-режима
- Включён RLS, insert/update разрешён всем для MVP

## Технологии
- Next.js 14
- Supabase
- React Query
- TailwindCSS

# Состояние разработки

## Основные концепты

### Бизнес-логика
1. **Процесс работы с письмами:**
   - Сотрудники получают почту
   - Раскладывают по папкам с номерами комнат
   - При сканировании первого штрих-кода письмо заносится в систему
   - Получатель уведомляется через Telegram
   - При выдаче письма сканируется второй штрих-код
   - Письмо отмечается как выданное в системе

2. Организация хранения:
   - Каждая папка (комната) имеет два уникальных штрих-кода
   - Первый - для регистрации входящих писем
   - Второй - для отметки о выдаче

3. Уведомления:
   - Мгновенные уведомления через Telegram при получении письма
   - Статус письма отслеживается в системе
   - История получения и выдачи писем

### Технические решения
1. Управление данными:
   - Эффективное кэширование с React Query
   - Оптимистичные обновления UI
   - Обработка ошибок и повторные попытки

2. Архитектура данных:
   - Связь писем и комнат через внешний ключ
   - Представление для объединенных данных
   - Индексы для быстрого поиска

3. Безопасность:
   - Row Level Security в Supabase
   - Аутентификация пользователей
   - Защита от дублирования писем

4. Мобильная оптимизация:
   - Адаптивный интерфейс
   - Оптимизация для работы со сканером
   - Быстрая загрузка данных

## Текущая структура проекта

1. База данных (Supabase):
   - Таблица `rooms`

# Руководство по разработке

## Настройка окружения

### Требования
- Node.js 18+ 
- npm 9+
- Git

### Настройка IDE
Рекомендуется использовать VS Code со следующими расширениями:
- ESLint
- Prettier
- Tailwind CSS IntelliSense
- TypeScript Vue Plugin (Volar)

## Структура проекта

```
email_camp/
├── src/
│   ├── app/              # Next.js App Router
│   ├── components/       # React компоненты
│   ├── hooks/           # Пользовательские хуки
│   ├── lib/             # Утилиты и конфигурация
│   └── types/           # TypeScript типы
├── public/              # Статические файлы
├── docs/               # Документация
└── tests/              # Тесты
```

## Рабочий процесс

### 1. Создание новой функциональности

1. Создайте ветку от `master`:
```bash
git checkout -b feature/название-функционала
```

2. Разработка:
- Следуйте принципам TypeScript
- Используйте компонентный подход
- Пишите тесты для новой функциональности

3. Проверка кода:
```bash
npm run lint      # Проверка линтером
npm run test      # Запуск тестов
```

### 2. Коммиты

Используйте conventional commits:

- `feat:` - новая функциональность
- `fix:` - исправление ошибок
- `docs:` - изменения в документации
- `style:` - форматирование кода
- `refactor:` - рефакторинг кода
- `test:` - добавление тестов
- `chore:` - обновление зависимостей

### 3. Code Review

1. Создайте Pull Request в GitHub
2. Дождитесь проверки кода
3. Внесите необходимые правки
4. После одобрения выполните merge в `master`

## Работа с базой данных

### Supabase

1. Миграции:
```bash
supabase migration new название-миграции
```

2. Применение миграций:
```bash
supabase db reset
```

### Типы данных

Обновление типов после изменения схемы:
```bash
supabase gen types typescript --local > src/lib/database.types.ts
```

## Стиль кода

### TypeScript

- Используйте строгую типизацию
- Избегайте `any`
- Документируйте сложные типы

### React

- Используйте функциональные компоненты
- Применяйте хуки для управления состоянием
- Разделяйте логику и представление

### CSS

- Используйте Tailwind CSS классы
- Следуйте Mobile First подходу
- Создавайте переиспользуемые компоненты

## Тестирование

### Unit тесты

```bash
npm run test:unit
```

### E2E тесты

```bash
npm run test:e2e
```

## Деплой

### Подготовка к продакшену

1. Сборка проекта:
```bash
npm run build
```

2. Проверка сборки:
```bash
npm run start
```

### Vercel

Деплой происходит автоматически при пуше в `master`

## Решение проблем

### Очистка кэша

```bash
npm run clean
npm install
```

### Обновление зависимостей

```bash
npm update
```

## Полезные команды

```bash
npm run dev          # Запуск в режиме разработки
npm run build        # Сборка проекта
npm run start        # Запуск собранного проекта
npm run lint         # Проверка линтером
npm run lint:fix     # Автоисправление линтером
npm run format       # Форматирование кода
npm run test         # Запуск всех тестов
```

## План на портфолио

### 1. Реальные интеграции и production-like фичи
- Реальная отправка email (Resend, SendGrid, Mailgun и др.)
- Интеграция с Telegram (Bot API)
- Интеграция с SMS (Twilio и др.) — даже тестовая, для демонстрации расширяемости
- Возможность подключать новые каналы через UI (feature toggle)

### 2. Панель администратора (done partialy)
- Управление пользователями, комнатами, письмами (CRUD) (done)
- Просмотр логов отправки уведомлений (успех/ошибка по каждому письму и каналу)
- Фильтрация и поиск по письмам, пользователям, статусам уведомлений (done)

### 3. Аутентификация и роли
- Вход через email/пароль, Google, Telegram (Supabase Auth или NextAuth)
- Роли: админ, оператор, пользователь — разные права доступа к разделам

### 4. UX/UI
- Мобильная адаптивность (responsive layout) (done)
- Темная тема (switcher)
- Информативные toast-уведомления, skeleton-загрузки, спиннеры (done)
- Drag-and-drop для загрузки фото (done)

### 5. Тесты
- Юнит-тесты для сервисов (например, notification dispatcher)
- E2E-тесты (Playwright или Cypress) для сценариев "добавить письмо — отправить уведомление — проверить статус"

### 6. Документация и DevOps
- README с описанием архитектуры, скриншотами, схемой БД
- OpenAPI/Swagger для API-роутов
- Dockerfile и docker-compose для быстрого запуска
- CI/CD (GitHub Actions) — линтер, тесты, деплой

### 7. Дополнительные "вау"-фичи
- Push-уведомления (Web Push API)
- Экспорт/импорт данных (CSV, Excel)
- История изменений (audit log) по письмам и уведомлениям
- Вебхуки для интеграции с внешними сервисами
- Мультиязычность (i18n)

### 8. UI/UX для портфолио
- Демо-режим (guest login, фейковые данные)
- Красивый landing page с описанием возможностей
- Скринкасты или gif-демонстрации в README

### 9. Архитектурные плюсы
- Чистая архитектура, разделение слоев, DI, паттерны (Strategy, Factory, Observer)
- Работа с миграциями, RLS, политиками безопасности

### 10. Работа с реальными API
- Интеграция с внешними REST API (например, получение курсов валют, погоды и т.д.) — как пример расширяемости

---

**Что особенно важно для портфолио фрилансера:**
- Покажи, что ты умеешь делать production-ready проекты, а не только "todo-list"
- Покажи, что умеешь работать с реальными сервисами, API, безопасностью, тестами, DevOps
- Покажи, что твой код легко поддерживать и расширять

## Управление пользователями (/admin/users) done
Список всех пользователей с их данными
Поиск по пользователям
Базовые действия (Редактировать/Удалить)
Отображение каналов уведомлений
## Управление комнатами (/admin/rooms) done
Список всех комнат
Поиск по комнатам
Базовые действия (Редактировать/Удалить)
Отображение даты создания
## Управление письмами (/admin/letters) (done)
Список всех писем с объединёнными данными (комната, получатель)
Поиск по номеру комнаты или получателю
Индикаторы статуса
Статус уведомления
Базовые действия (Просмотр/Удалить)
### В каждом разделе:
Современный, чистый UI на Tailwind CSS
Адаптивные таблицы
Состояния загрузки
Поиск
Кнопки действий
Индикаторы статуса (где нужно)
### Следующие шаги могут быть такими:
Реализация функционала добавления пользователей и комнат
Добавление редактирования и удаления
Создание детального просмотра письма
Добавление пагинации для больших списков
Реализация сортировки
Добавление фильтров по статусу и дате
Создание ролей пользователей и прав доступа
Хотите, чтобы я приступил к какому-то из этих следующих шагов?


# описание проекта как отдельная часть сайта

Предлагаемые роуты
bash
Copy
Edit
/docs
/docs/overview
/docs/features
/docs/architecture
/docs/tech-stack
/docs/getting-started
/docs/contributing
/docs/roadmap
1. /docs/overview — Общий обзор
Цель проекта: объясните, зачем он нужен (MVP, кейс использования).

Ключевые сущности: Комната, Письмо (слайдер-карточки или иконки + краткие описания).

Пользовательские роли (если есть): администратор, сотрудник, получатель.

2. /docs/features — Функциональность
Разбейте на блоки:

Комнаты

Просмотр списка комнат, количество писем.

Фильтрация / поиск по номеру.

Письма

Добавление письма (сканер или форма).

Просмотр истории писем в комнате.

Изменение статусов: pending → delivered.

Уведомления

Telegram-оповещения при добавлении.

Email (если есть).

Админка (если планируется): CRUD для сущностей.

Каждый блок — заголовок, параграф + скриншот или код-сниппет.

3. /docs/architecture — Архитектура системы
Схема базы (ER-диаграмма для rooms и letters).

Потоки данных: вставка письма → триггер supabase → отправка Telegram → Webhook/функция.

RLS: политики безопасности, роли, service-role key.

API: REST via PostgREST, Realtime каналы.

4. /docs/tech-stack — Технологии
Для каждой технологии — логотип + краткое описание:

Frontend: Next.js 14 (App Router), React Query, Tailwind CSS.

Backend/Data: Supabase (Postgres + Realtime + Storage), RLS.

Интеграции: Telegram Bot API, почтовый сервис (Resend / SMTP).

DevOps: Vercel (CI/CD), миграции supabase CLI.

Тестирование: Jest (unit), Playwright или Cypress (e2e).

5. /docs/getting-started — Как запустить локально
Requirements: Node.js, npm, supabase CLI.

Шаги: clone, npm install, supabase start, npm run dev.

Настройка ENV: пример .env.local.

Миграции и типы: supabase migration, supabase gen types.

6. /docs/contributing — Как внести вклад
Кодстайл: ESLint, Prettier, Tailwindlint.

Workflow: ветки feature/, conventional commits, PR review.

Тесты: запуск npm run test, npm run lint.

CI: что проверяет GitHub Actions/Vercel.

7. /docs/roadmap — Дальнейшие планы
PWA & Offline

Штрих-коды: интеграция сканера, API.

Расширенный UI: фильтры, сортировки.

Дополнительные каналы нотификаций: Email, SMS.

Мультиязычность

Интеграции с ERP/CRM

Как отобразить
Главная страница документации (/docs) с карточками-ссылками на каждую секцию.

Внутри каждой страницы:

Breadcrumbs: /docs › Features

Оглавление (хуки, React-scrollspy) слева для длинных страниц.

Код-сниппеты обёрнутые в <pre><code>…</code></pre> с подсветкой.

Диаграммы: ER-диаграмма, sequence diagrams — через Mermaid или вставленное изображение.

Таблицы: для endpoint-ов API (метод, URL, params, response).