# DEVELOPMENT

## Основные сущности
- **Комната** (`rooms`): уникальный номер комнаты, `telegram_chat_id` (опционально)
- **Письмо** (`letters`): привязка к комнате (`room_id`), статус, дата добавления, дата доставки, `sync_status`

## MVP-функционал
- Просмотр всех комнат и количества писем в каждой
- Просмотр и добавление писем для выбранной комнаты
- Нет поддержки штрих-кодов и PWA

## UI
- **Главная страница:** список комнат и количество писем
- **Страница комнаты:** список писем и форма добавления письма (только номер комнаты)

## База данных
- Нет поля `barcode_id`
- Нет поддержки PWA и офлайн-режима
- Включён RLS, insert/update разрешён всем для MVP

## Технологии
- Next.js 14
- Supabase
- React Query
- TailwindCSS

# Состояние разработки

## Основные концепты

### Бизнес-логика
1. **Процесс работы с письмами:**
   - Сотрудники получают почту
   - Раскладывают по папкам с номерами комнат
   - При сканировании первого штрих-кода письмо заносится в систему
   - Получатель уведомляется через Telegram
   - При выдаче письма сканируется второй штрих-код
   - Письмо отмечается как выданное в системе

2. Организация хранения:
   - Каждая папка (комната) имеет два уникальных штрих-кода
   - Первый - для регистрации входящих писем
   - Второй - для отметки о выдаче

3. Уведомления:
   - Мгновенные уведомления через Telegram при получении письма
   - Статус письма отслеживается в системе
   - История получения и выдачи писем

### Технические решения
1. Управление данными:
   - Эффективное кэширование с React Query
   - Оптимистичные обновления UI
   - Обработка ошибок и повторные попытки

2. Архитектура данных:
   - Связь писем и комнат через внешний ключ
   - Представление для объединенных данных
   - Индексы для быстрого поиска

3. Безопасность:
   - Row Level Security в Supabase
   - Аутентификация пользователей
   - Защита от дублирования писем

4. Мобильная оптимизация:
   - Адаптивный интерфейс
   - Оптимизация для работы со сканером
   - Быстрая загрузка данных

## Текущая структура проекта

1. База данных (Supabase):
   - Таблица `rooms`

# Руководство по разработке

## Настройка окружения

### Требования
- Node.js 18+ 
- npm 9+
- Git

### Настройка IDE
Рекомендуется использовать VS Code со следующими расширениями:
- ESLint
- Prettier
- Tailwind CSS IntelliSense
- TypeScript Vue Plugin (Volar)

## Структура проекта

```
email_camp/
├── src/
│   ├── app/              # Next.js App Router
│   ├── components/       # React компоненты
│   ├── hooks/           # Пользовательские хуки
│   ├── lib/             # Утилиты и конфигурация
│   └── types/           # TypeScript типы
├── public/              # Статические файлы
├── docs/               # Документация
└── tests/              # Тесты
```

## Рабочий процесс

### 1. Создание новой функциональности

1. Создайте ветку от `master`:
```bash
git checkout -b feature/название-функционала
```

2. Разработка:
- Следуйте принципам TypeScript
- Используйте компонентный подход
- Пишите тесты для новой функциональности

3. Проверка кода:
```bash
npm run lint      # Проверка линтером
npm run test      # Запуск тестов
```

### 2. Коммиты

Используйте conventional commits:

- `feat:` - новая функциональность
- `fix:` - исправление ошибок
- `docs:` - изменения в документации
- `style:` - форматирование кода
- `refactor:` - рефакторинг кода
- `test:` - добавление тестов
- `chore:` - обновление зависимостей

### 3. Code Review

1. Создайте Pull Request в GitHub
2. Дождитесь проверки кода
3. Внесите необходимые правки
4. После одобрения выполните merge в `master`

## Работа с базой данных

### Supabase

1. Миграции:
```bash
supabase migration new название-миграции
```

2. Применение миграций:
```bash
supabase db reset
```

### Типы данных

Обновление типов после изменения схемы:
```bash
supabase gen types typescript --local > src/lib/database.types.ts
```

## Стиль кода

### TypeScript

- Используйте строгую типизацию
- Избегайте `any`
- Документируйте сложные типы

### React

- Используйте функциональные компоненты
- Применяйте хуки для управления состоянием
- Разделяйте логику и представление

### CSS

- Используйте Tailwind CSS классы
- Следуйте Mobile First подходу
- Создавайте переиспользуемые компоненты

## Тестирование

### Unit тесты

```bash
npm run test:unit
```

### E2E тесты

```bash
npm run test:e2e
```

## Деплой

### Подготовка к продакшену

1. Сборка проекта:
```bash
npm run build
```

2. Проверка сборки:
```bash
npm run start
```

### Vercel

Деплой происходит автоматически при пуше в `master`

## Решение проблем

### Очистка кэша

```bash
npm run clean
npm install
```

### Обновление зависимостей

```bash
npm update
```

## Полезные команды

```bash
npm run dev          # Запуск в режиме разработки
npm run build        # Сборка проекта
npm run start        # Запуск собранного проекта
npm run lint         # Проверка линтером
npm run lint:fix     # Автоисправление линтером
npm run format       # Форматирование кода
npm run test         # Запуск всех тестов
```

## План на портфолио

### 1. Реальные интеграции и production-like фичи
- Реальная отправка email (Resend, SendGrid, Mailgun и др.)
- Интеграция с Telegram (Bot API)
- Интеграция с SMS (Twilio и др.) — даже тестовая, для демонстрации расширяемости
- Возможность подключать новые каналы через UI (feature toggle)

### 2. Панель администратора
- Управление пользователями, комнатами, письмами (CRUD)
- Просмотр логов отправки уведомлений (успех/ошибка по каждому письму и каналу)
- Фильтрация и поиск по письмам, пользователям, статусам уведомлений

### 3. Аутентификация и роли
- Вход через email/пароль, Google, Telegram (Supabase Auth или NextAuth)
- Роли: админ, оператор, пользователь — разные права доступа к разделам

### 4. UX/UI
- Мобильная адаптивность (responsive layout)
- Темная тема (switcher)
- Информативные toast-уведомления, skeleton-загрузки, спиннеры
- Drag-and-drop для загрузки фото (done)

### 5. Тесты
- Юнит-тесты для сервисов (например, notification dispatcher)
- E2E-тесты (Playwright или Cypress) для сценариев "добавить письмо — отправить уведомление — проверить статус"

### 6. Документация и DevOps
- README с описанием архитектуры, скриншотами, схемой БД
- OpenAPI/Swagger для API-роутов
- Dockerfile и docker-compose для быстрого запуска
- CI/CD (GitHub Actions) — линтер, тесты, деплой

### 7. Дополнительные "вау"-фичи
- Push-уведомления (Web Push API)
- Экспорт/импорт данных (CSV, Excel)
- История изменений (audit log) по письмам и уведомлениям
- Вебхуки для интеграции с внешними сервисами
- Мультиязычность (i18n)

### 8. UI/UX для портфолио
- Демо-режим (guest login, фейковые данные)
- Красивый landing page с описанием возможностей
- Скринкасты или gif-демонстрации в README

### 9. Архитектурные плюсы
- Чистая архитектура, разделение слоев, DI, паттерны (Strategy, Factory, Observer)
- Работа с миграциями, RLS, политиками безопасности

### 10. Работа с реальными API
- Интеграция с внешними REST API (например, получение курсов валют, погоды и т.д.) — как пример расширяемости

---

**Что особенно важно для портфолио фрилансера:**
- Покажи, что ты умеешь делать production-ready проекты, а не только "todo-list"
- Покажи, что умеешь работать с реальными сервисами, API, безопасностью, тестами, DevOps
- Покажи, что твой код легко поддерживать и расширять

## Управление пользователями (/admin/users)
Список всех пользователей с их данными
Поиск по пользователям
Базовые действия (Редактировать/Удалить)
Отображение каналов уведомлений
## Управление комнатами (/admin/rooms)
Список всех комнат
Поиск по комнатам
Базовые действия (Редактировать/Удалить)
Отображение даты создания
## Управление письмами (/admin/letters)
Список всех писем с объединёнными данными (комната, получатель)
Поиск по номеру комнаты или получателю
Индикаторы статуса
Статус уведомления
Базовые действия (Просмотр/Удалить)
### В каждом разделе:
Современный, чистый UI на Tailwind CSS
Адаптивные таблицы
Состояния загрузки
Поиск
Кнопки действий
Индикаторы статуса (где нужно)
### Следующие шаги могут быть такими:
Реализация функционала добавления пользователей и комнат
Добавление редактирования и удаления
Создание детального просмотра письма
Добавление пагинации для больших списков
Реализация сортировки
Добавление фильтров по статусу и дате
Создание ролей пользователей и прав доступа
Хотите, чтобы я приступил к какому-то из этих следующих шагов?