# Состояние разработки

## Основные концепты

### Бизнес-логика
1. Процесс работы с письмами:
   - Сотрудники получают почту
   - Раскладывают по папкам с номерами комнат
   - При сканировании первого штрих-кода письмо заносится в систему
   - Получатель уведомляется через Telegram
   - При выдаче письма сканируется второй штрих-код
   - Письмо отмечается как выданное в системе

2. Организация хранения:
   - Каждая папка (комната) имеет два уникальных штрих-кода
   - Первый - для регистрации входящих писем
   - Второй - для отметки о выдаче

3. Уведомления:
   - Мгновенные уведомления через Telegram при получении письма
   - Статус письма отслеживается в системе
   - История получения и выдачи писем

### Технические решения
1. Управление данными:
   - Эффективное кэширование с React Query
   - Оптимистичные обновления UI
   - Обработка ошибок и повторные попытки

2. Архитектура данных:
   - Связь писем и комнат через внешний ключ
   - Представление для объединенных данных
   - Индексы для быстрого поиска

3. Безопасность:
   - Row Level Security в Supabase
   - Аутентификация пользователей
   - Защита от дублирования писем

4. Мобильная оптимизация:
   - Адаптивный интерфейс
   - Оптимизация для работы со сканером
   - Быстрая загрузка данных

## Текущая структура проекта

1. База данных (Supabase):
   - Таблица `rooms`

# Руководство по разработке

## Настройка окружения

### Требования
- Node.js 18+ 
- npm 9+
- Git

### Настройка IDE
Рекомендуется использовать VS Code со следующими расширениями:
- ESLint
- Prettier
- Tailwind CSS IntelliSense
- TypeScript Vue Plugin (Volar)

## Структура проекта

```
email_camp/
├── src/
│   ├── app/              # Next.js App Router
│   ├── components/       # React компоненты
│   ├── hooks/           # Пользовательские хуки
│   ├── lib/             # Утилиты и конфигурация
│   └── types/           # TypeScript типы
├── public/              # Статические файлы
├── docs/               # Документация
└── tests/              # Тесты
```

## Рабочий процесс

### 1. Создание новой функциональности

1. Создайте ветку от `master`:
```bash
git checkout -b feature/название-функционала
```

2. Разработка:
- Следуйте принципам TypeScript
- Используйте компонентный подход
- Пишите тесты для новой функциональности

3. Проверка кода:
```bash
npm run lint      # Проверка линтером
npm run test      # Запуск тестов
```

### 2. Коммиты

Используйте conventional commits:

- `feat:` - новая функциональность
- `fix:` - исправление ошибок
- `docs:` - изменения в документации
- `style:` - форматирование кода
- `refactor:` - рефакторинг кода
- `test:` - добавление тестов
- `chore:` - обновление зависимостей

### 3. Code Review

1. Создайте Pull Request в GitHub
2. Дождитесь проверки кода
3. Внесите необходимые правки
4. После одобрения выполните merge в `master`

## Работа с базой данных

### Supabase

1. Миграции:
```bash
supabase migration new название-миграции
```

2. Применение миграций:
```bash
supabase db reset
```

### Типы данных

Обновление типов после изменения схемы:
```bash
supabase gen types typescript --local > src/lib/database.types.ts
```

## Стиль кода

### TypeScript

- Используйте строгую типизацию
- Избегайте `any`
- Документируйте сложные типы

### React

- Используйте функциональные компоненты
- Применяйте хуки для управления состоянием
- Разделяйте логику и представление

### CSS

- Используйте Tailwind CSS классы
- Следуйте Mobile First подходу
- Создавайте переиспользуемые компоненты

## Тестирование

### Unit тесты

```bash
npm run test:unit
```

### E2E тесты

```bash
npm run test:e2e
```

## Деплой

### Подготовка к продакшену

1. Сборка проекта:
```bash
npm run build
```

2. Проверка сборки:
```bash
npm run start
```

### Vercel

Деплой происходит автоматически при пуше в `master`

## Решение проблем

### Очистка кэша

```bash
npm run clean
npm install
```

### Обновление зависимостей

```bash
npm update
```

## Полезные команды

```bash
npm run dev          # Запуск в режиме разработки
npm run build        # Сборка проекта
npm run start        # Запуск собранного проекта
npm run lint         # Проверка линтером
npm run lint:fix     # Автоисправление линтером
npm run format       # Форматирование кода
npm run test         # Запуск всех тестов
```