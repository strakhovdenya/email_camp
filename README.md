# Email Camp

Современная система учёта и выдачи писем для лагеря.

## Возможности
- Учёт комнат (room_number)
- Учёт писем (привязка к комнате, статус, дата добавления, дата выдачи, sync_status)
- Учёт пользователей (админ, сотрудник, отдыхающий) с ролями и email
- Email-уведомления получателям при добавлении письма
- Фильтрация писем по пользователям (получателям)
- Статус email-уведомления (отправлено/не отправлено)
- Просмотр и выдача писем по комнатам
- Централизованная логика добавления и выдачи писем (React Query hooks)
- Строгая типизация TypeScript
- Современный UI на TailwindCSS
- Toast-уведомления для всех ключевых действий и ошибок
- Интерфейс только на английском (можно локализовать)

## Технологии
- Next.js 14 (App Router)
- Supabase (Postgres, RLS, Storage)
- React Query
- TailwindCSS
- Resend (email-рассылка)

## Структура базы данных
- **rooms**: id, room_number, telegram_chat_id, created_at
- **users**: id, first_name, last_name, phone, email, room_id, role, created_at
- **letters**: id, room_id, status, created_at, delivered_at, sync_status, note, photo_url, user_id, recipient_notified

## Как это работает
1. На главной странице отображается список комнат и количество писем в каждой.
2. Для каждой комнаты можно открыть отдельную страницу (`/room/[roomNumber]`), где отображается список писем и форма для добавления нового письма.
3. При добавлении письма выбирается получатель (пользователь) и можно загрузить фото.
4. Система отправляет email-уведомление получателю (если указан email).
5. На странице выдачи писем (`/deliver/[roomNumber]`) можно фильтровать письма по пользователям и отмечать их как выданные.
6. Для каждого письма отображается статус email-уведомления (с предупреждением, если не отправлено).

## Безопасность
- Включён RLS (Row Level Security) для всех таблиц.
- Для MVP insert/update разрешён всем пользователям.

## Пример интерфейса
- Форма добавления письма с полями для комнаты, описания, фото и получателя
- Список писем со статусом, именем получателя, датой выдачи и статусом email-уведомления
- Toast-уведомления для всех действий

## Быстрый старт

1. Клонировать репозиторий:
```bash
git clone <URL-репозитория>
cd email_camp
```

2. Установить зависимости:
```bash
npm install
```

3. Создать файл `.env.local` и добавить переменные окружения:
```
NEXT_PUBLIC_SUPABASE_URL=адрес-проекта
NEXT_PUBLIC_SUPABASE_ANON_KEY=анон-ключ
RESEND_API_KEY=ключ-resend
```

4. Запустить проект:
```bash
npm run dev
```

## Лицензия
MIT 